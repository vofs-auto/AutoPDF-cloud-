<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AutoPDF Cloud — Batch Cards</title>
  <style>
    :root{
      --bg:#071126; --card:#0f1b2b; --accent:#00e6ff; --muted:#9fb6c9; --good:#0f8a4a; --bad:#c62828;
      --btn:#00b7ff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#e6f6ff;min-height:100vh;display:flex;flex-direction:column}
    header{padding:14px 18px;background:linear-gradient(90deg,#00121f,#002b45);display:flex;align-items:center;justify-content:space-between}
    header h1{font-size:1rem;margin:0;color:var(--accent)}
    .top-right{display:flex;gap:8px;align-items:center}
    .tabs{display:flex;gap:0;border-bottom:1px solid rgba(255,255,255,0.03)}
    .tab{flex:1;padding:12px;text-align:center;cursor:pointer;background:transparent;color:var(--muted)}
    .tab.active{color:var(--accent);border-bottom:3px solid var(--accent);background:linear-gradient(180deg,rgba(0,0,0,0.15),transparent)}
    main{flex:1;display:flex;gap:18px;padding:16px;align-items:flex-start}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;flex:1;min-width:260px}
    .small{font-size:13px;color:var(--muted);margin-bottom:8px}
    input,textarea,select,button{border-radius:8px;border:0;padding:10px;font-size:14px}
    textarea{min-height:60px;background:#081626;color:inherit;resize:vertical}
    .row{display:flex;gap:8px;margin-bottom:8px}
    .row input{flex:1;background:#071826;color:inherit}
    .actions{display:flex;gap:8px;align-items:center}
    .btn{background:var(--btn);color:#001;padding:10px 12px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(0,183,255,0.12)}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
    .list{display:flex;flex-direction:column;gap:10px;max-height:62vh;overflow:auto;padding-right:6px}
    .item{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:12px;border-radius:10px;display:grid;grid-template-columns:1fr 80px;gap:8px;align-items:start}
    .fields{display:flex;flex-direction:column;gap:8px}
    .label{font-size:12px;color:var(--muted)}
    .controls{display:flex;flex-direction:column;gap:8px;align-items:center}
    .add{background:linear-gradient(90deg,#46d6aa,#17b978);color:#002;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}
    .remove{background:linear-gradient(90deg,#ff5454,#c62828);color:white;padding:6px 10px;border-radius:8px;cursor:pointer;border:0}
    .limitNote{font-size:13px;color:#ffdca8;margin-top:6px}
    .status{font-size:13px;color:var(--accent);margin-top:10px;text-align:center}
    .ad-banner{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);background:#05041a;color:var(--accent);padding:10px 14px;border-radius:10px;border:1px solid rgba(0,230,255,0.06)}
    footer{padding:10px 16px;text-align:center;color:#9fb6c9;font-size:13px}
    @media (max-width:900px){
      main{flex-direction:column}
      .item{grid-template-columns:1fr;align-items:stretch}
      .controls{flex-direction:row;justify-content:flex-end}
    }
  </style>
</head>
<body>
  <header>
    <h1>AutoPDF Cloud — Batch Cards</h1>
    <div class="top-right">
  <div style="font-size:13px;color:var(--muted)">Logged: Guest</div>
  <div style="width:8px"></div>
  <div title="PDFs generated" id="pdfCount" style="color:#00e6ff;font-weight:600;">PDFs: {{count}}</div>
  <div style="width:8px"></div>
  <div title="Settings">⚙️</div>
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="openTab('pdf')">Generate PDF</div>
    <div class="tab" onclick="openTab('batch')">Batch PDF Bot</div>
  </div>

  <main>
    <!-- left: pdf single -->
    <section class="panel" id="pdf" style="flex-basis:380px">
      <div class="small">Single PDF — upload or type text</div>
      <div style="display:flex;flex-direction:column;gap:10px">
        <input type="file" id="pdfFile" accept=".pdf" />
        <textarea id="pdfText" placeholder="Type content here..."></textarea>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="generatePDF()">Generate PDF</button>
          <button class="btn ghost" onclick="clearSingle()">Clear</button>
        </div>
        <div class="small" style="margin-top:6px;color:var(--muted)">Works with uploaded PDF text extraction or typed content.</div>
      </div>
    </section>

    <!-- right: batch -->
    <section class="panel" id="batch" style="flex:2">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong style="color:var(--accent)">Batch PDF Creator (cards)</strong><div class="small">Max 82 entries — one card per PDF page</div></div>
        <div class="actions">
          <button class="add" id="addBtn">+ Add Entry</button>
          <button class="btn" id="generateBatch">Generate Batch PDF</button>
        </div>
      </div>

      <div class="list" id="entries"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="limitNote">Limit: <strong id="count">0</strong> / 82</div>
        <div style="display:flex;gap:8px">
          <button class="btn ghost" onclick="loadExample()">Load Example</button>
          <button class="btn ghost" onclick="clearAll()">Clear All</button>
        </div>
      </div>
      <div id="batchStatus" class="status"></div>
    </section>
  </main>

  <div class="ad-banner">AD:</div>

  <footer>
    <a href="/about">About</a> • <a href="/contact">Contact</a> • <a href="/privacy">Privacy</a> • <a href="/terms">Terms</a>
  </footer>

<script>
/* CORE: manage entries up to 82 */
const MAX = 82;
let idx = 0;
const list = document.getElementById('entries');
const countEl = document.getElementById('count');
const statusEl = document.getElementById('batchStatus');

function updateCount(){ countEl.textContent = list.children.length; }

function makeItem(data){
  idx++;
  const id = 'it'+idx;
  const div = document.createElement('div');
  div.className = 'item';
  div.id = id;
  div.innerHTML = `
    <div class="fields">
      <div class="label">Assunto (subject)</div>
      <input placeholder="Ex: Product Brief" class="subject" value="${data?.subject||''}"/>
      <div class="label">Nome (name)</div>
      <input placeholder="Ex: Victor Octavio" class="name" value="${data?.name||''}"/>
      <div class="label">Data (date)</div>
      <input placeholder="Ex: 08/12/2024" class="date" value="${data?.date||''}"/>
      <div class="label">Detalhes (optional)</div>
      <textarea class="details" placeholder="Additional info: product, career, notes...">${data?.details||''}</textarea>
    </div>
    <div class="controls">
      <button class="add" title="Add page" onclick="addNear('${id}')">+ Add</button>
      <button class="remove" title="Remove page" onclick="removeItem('${id}')">− Remove</button>
    </div>
  `;
  return div;
}

function addItemAtEnd(data){
  if(list.children.length >= MAX){ alert('Max entries reached: '+MAX); return; }
  const it = makeItem(data);
  list.appendChild(it);
  updateCount();
}
function addNear(id){
  if(list.children.length >= MAX){ alert('Max reached'); return; }
  const ref = document.getElementById(id);
  const next = ref.nextSibling;
  const it = makeItem();
  if(next) list.insertBefore(it, next); else list.appendChild(it);
  updateCount();
}
function removeItem(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.remove();
  updateCount();
}
document.getElementById('addBtn').addEventListener('click', ()=>addItemAtEnd());

function clearAll(){ if(confirm('Clear all entries?')){ list.innerHTML=''; updateCount(); statusEl.textContent=''; } }
function clearSingle(){ document.getElementById('pdfText').value=''; }

function loadExample(){
  clearAll();
  addItemAtEnd({subject:'Curriculum - Developer',name:'Victor Octavio',date:'08/12/2024',details:'Full-stack developer'});
  addItemAtEnd({subject:'Product Brief',name:'Widget 3000',date:'01/01/2025',details:'Specs and pricing'});
  statusEl.textContent='Loaded 2 example entries';
}

/* collect rows and POST JSON to backend */
async function generateBatch(){
  const items = Array.from(list.children);
  if(items.length===0){ alert('Add at least 1 entry'); return; }
  const rows = [];
  for(const it of items){
    const subject = it.querySelector('.subject').value.trim();
    const name = it.querySelector('.name').value.trim();
    const date = it.querySelector('.date').value.trim();
    const details = it.querySelector('.details').value.trim();
    rows.push({subject,name,date,details});
  }
  statusEl.textContent='Generating PDF — please wait...';
  document.getElementById('generateBatch').disabled = true;

  try{
    const res = await fetch('/generate_batch', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({rows})
    });
    if(!res.ok){ const err = await res.text(); throw new Error(err||'Server error'); }
    const blob = await res.blob();
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'batch_cards.pdf'; a.click();
    statusEl.textContent = '✅ Batch PDF generated';
  }catch(e){
    statusEl.textContent = 'Error: '+e.message;
  }finally{
    document.getElementById('generateBatch').disabled = false;
  }
}

/* wire buttons */
document.getElementById('generateBatch').addEventListener('click', generateBatch);

/* small PDF single generator using existing endpoints (keeps old behavior) */
async function generatePDF(){
  const file = document.getElementById('pdfFile').files[0];
  if(file){
    const form = new FormData(); form.append('file', file);
    const r = await fetch('/upload_pdf', {method:'POST', body:form});
    const j = await r.json(); document.getElementById('pdfText').value = j.text || '';
  }
  const form = new FormData(); form.append('text', document.getElementById('pdfText').value || 'Hello');
  const r2 = await fetch('/generate_pdf', {method:'POST', body:form});
  const blob = await r2.blob(); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='document.pdf'; a.click();
}

/* init */
updateCount();
  async function refreshCounter(){
  try{
    const res = await fetch('/counter');
    const j = await res.json();
    document.getElementById('pdfCount').textContent = "PDFs: " + j.count;
  }catch(e){}
}
setInterval(refreshCounter, 6000);
</script>
</body>
          </html>
