<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AutoPDF Cloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --text: #e6edf3;
      --accent: #00e6ff;
      --muted: #8b949e;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", system-ui, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      background-color: var(--card);
      border-bottom: 1px solid #1f2937;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      color: var(--accent);
    }
    .top-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
    }
    .container {
      flex: 1;
      max-width: 950px;
      margin: 25px auto;
      padding: 20px;
      background-color: var(--card);
      border-radius: 14px;
      box-shadow: 0 0 14px rgba(0,0,0,0.4);
    }
    textarea, input {
      width: 100%;
      background-color: #0d1117;
      color: var(--text);
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      resize: vertical;
    }
    button {
      background-color: var(--accent);
      color: #000;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { opacity: 0.85; }
    hr { border-color: #1f2937; margin: 30px 0; }

    .batch-block {
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 10px;
      margin-top: 10px;
      background-color: #0d1117;
    }
    .batch-block input, .batch-block textarea {
      margin-top: 6px;
    }
    .remove-row-btn {
      background-color: #ff4d4d;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 8px;
    }
    .add-row-btn { background-color: #00ffcc; color: #000; margin-top: 10px; }
    #ad-banner {
      background:#1a0033;
      color:#00eaff;
      text-align:center;
      padding:6px;
      font-size:11px;
    }
    footer {
      text-align: center;
      padding: 15px;
      font-size: 12px;
      color: var(--muted);
      border-top: 1px solid #1f2937;
      margin-top: 30px;
    }
    footer a {
      color: var(--muted);
      margin: 0 8px;
      text-decoration: none;
    }
    footer a:hover { color: var(--accent); }
    #adminPanel {
      display:none;
      position:fixed;
      top:10%;
      left:50%;
      transform:translateX(-50%);
      background:var(--card);
      padding:20px;
      border-radius:10px;
      width:90%;
      max-width:500px;
      box-shadow:0 0 10px rgba(0,255,255,0.2);
    }
    #adminPanel h3 { color:var(--accent); margin-bottom:10px; text-align:center; }
    #closeAdmin { background:#ff3b3b; color:white; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; float:right; }
    @media (max-width: 600px) {
      .container { margin: 10px; padding: 14px; }
      header h1 { font-size: 17px; }
    }
  </style>
</head>
<body>

<header>
  <h1>AutoPDF Cloud</h1>
  <div class="top-right">
    <span style="color:var(--muted)">User: Guest</span>
    <span id="pdfCount" style="color:#00e6ff;font-weight:600;">PDFs: {{count}}</span>
    <span title="Settings" style="cursor:pointer;" onclick="toggleAdmin()">⚙️</span>
  </div>
</header>

<!-- Banner ads section -->
<div id="ad-banner">
  <strong>AD:</strong>
  <span>Your banner or ad script here</span>
</div>

<div class="container">
  <h2>Generate a Single PDF</h2>
  <textarea id="textInput" placeholder="Type or paste your text here..."></textarea>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
    <button onclick="generatePDF()">Generate PDF</button>
    <input type="file" id="fileInput" accept="application/pdf" onchange="uploadPDF()">
  </div>

  <hr>

  <h2>Batch PDF Bot (Card Mode)</h2>
  <p style="color:var(--muted);font-size:13px;">Fill up to 82 cards of information. Each card creates one PDF automatically.</p>

  <div id="batchContainer"></div>
  <button class="add-row-btn" onclick="addRow()">+ Add Card</button>
  <button onclick="generateBatch()">Generate Batch PDFs</button>
</div>

<footer>
  <a href="/about">About</a> |
  <a href="/contact">Contact</a> |
  <a href="/privacy">Privacy</a> |
  <a href="/terms">Terms</a>
</footer>

<div id="adminPanel">
  <button id="closeAdmin" onclick="toggleAdmin()">X</button>
  <h3>Admin Dashboard</h3>
  <div id="adminStats">Loading stats...</div>
</div>

<script>
async function generatePDF() {
  const text = document.getElementById("textInput").value;
  if (!text.trim()) return alert("Please type something first!");
  const formData = new FormData();
  formData.append("text", text);
  const res = await fetch("/generate_pdf", { method: "POST", body: formData });
  if (res.ok) {
    const blob = await res.blob();
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "document.pdf";
    a.click();
    refreshCounter();
  } else alert("Error generating PDF!");
}

async function uploadPDF() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return;
  const formData = new FormData();
  formData.append("file", file);
  const res = await fetch("/upload_pdf", { method: "POST", body: formData });
  const data = await res.json();
  if (data.text) document.getElementById("textInput").value = data.text;
  else alert("Error: " + (data.error || "Failed to extract text from PDF"));
}

function addRow() {
  const container = document.getElementById("batchContainer");
  if (container.children.length >= 82) return alert("Maximum of 82 cards allowed!");
  const div = document.createElement("div");
  div.className = "batch-block";
  div.innerHTML = `
    <label>Name / Product:</label>
    <input type="text" placeholder="Name or Product" />
    <label>Title / Subject:</label>
    <input type="text" placeholder="Title or Subject" />
    <label>Date:</label>
    <input type="text" placeholder="Date (e.g. 08/12/2025)" />
    <label>Details:</label>
    <textarea placeholder="Details..." style="height:40px"></textarea>
    <button class="remove-row-btn" onclick="this.parentElement.remove()">Remove</button>
  `;
  container.appendChild(div);
}

async function generateBatch() {
  const cards = [];
  document.querySelectorAll(".batch-block").forEach(div => {
    const inputs = div.querySelectorAll("input, textarea");
    const record = {
      name: inputs[0].value,
      subject: inputs[1].value,
      date: inputs[2].value,
      details: inputs[3].value
    };
    cards.push(record);
  });
  if (cards.length === 0) return alert("Add at least one card!");
  const res = await fetch("/generate_batch", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({rows: cards})
  });
  if (res.ok) {
    const blob = await res.blob();
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "batch_cards.pdf";
    a.click();
    refreshCounter();
  } else alert("Error generating batch!");
}

async function refreshCounter() {
  try {
    const res = await fetch("/counter");
    const data = await res.json();
    document.getElementById("pdfCount").textContent = "PDFs: " + data.count;
  } catch(e) {}
}
setInterval(refreshCounter, 8000);

function toggleAdmin() {
  const panel = document.getElementById("adminPanel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
  if (panel.style.display === "block") loadStats();
}

async function loadStats() {
  const res = await fetch("/admin_stats");
  const data = await res.json();
  document.getElementById("adminStats").innerHTML = `
    <p><strong>Total PDFs generated:</strong> ${data.total}</p>
    <p><strong>Today:</strong> ${data.today}</p>
    <p><strong>Users active:</strong> ${data.users}</p>
  `;
}
</script>

</body>
  </html>
